import A from"./GQPUnmNe.js";import{d as S,r as E,c as m,f as B,o as x,a as g,h as d,q as C,j as k,t as b,G as v,B as P,C as _,F as j,D as F,b as w,H as V,I}from"./CMCxBn70.js";const N={class:"relative"},U={class:"flex items-center gap-2"},L={class:"relative"},$={class:"text-gray-700"},J={class:"p-2"},D={class:"max-h-48 overflow-y-auto"},q=["onClick"],K={class:"text-gray-700"},M={class:"text-gray-500 ml-auto"},R={class:"flex-1"},G=["value","placeholder"],z={key:0,class:"mt-1 text-sm text-red-500"},te=S({__name:"UiPhoneInput",props:{modelValue:{},countryCode:{},placeholder:{},error:{},inputClass:{}},emits:["update:modelValue","update:countryCode"],setup(a,{emit:t}){const e=a,r=t,s=E(!1),u=E(""),p=[{name:"Saudi Arabia",code:"966",flag:"circle-flags:sa"},{name:"UAE",code:"971",flag:"circle-flags:ae"},{name:"Egypt",code:"20",flag:"circle-flags:eg"},{name:"Jordan",code:"962",flag:"circle-flags:jo"},{name:"Kuwait",code:"965",flag:"circle-flags:kw"},{name:"Qatar",code:"974",flag:"circle-flags:qa"},{name:"Bahrain",code:"973",flag:"circle-flags:bh"},{name:"Oman",code:"968",flag:"circle-flags:om"}],o=m(()=>p.find(n=>n.code===e.countryCode)||p[0]),l=m(()=>e.modelValue),f=m(()=>{if(!u.value)return p;const n=u.value.toLowerCase();return p.filter(h=>h.name.toLowerCase().includes(n)||h.code.includes(n))}),c=n=>{r("update:countryCode",n.code),s.value=!1},i=n=>{const h=n.target;r("update:modelValue",h.value)},O=n=>{n.target.closest(".relative")||(s.value=!1)};return B(()=>{document.addEventListener("click",O)}),x(()=>{document.removeEventListener("click",O)}),(n,h)=>{const T=A;return w(),g("div",N,[d("div",U,[d("div",L,[d("button",{type:"button",onClick:h[0]||(h[0]=y=>s.value=!s.value),class:"flex items-center gap-2 px-3 py-3 rounded-lg border border-gray-300 bg-gray-50 hover:bg-gray-100 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"},[k(T,{name:o.value.flag,class:"w-5 h-5"},null,8,["name"]),d("span",$,"+"+b(o.value.code),1),k(T,{name:"heroicons:chevron-down",class:v(["w-4 h-4 text-gray-500 transition-transform duration-200",{"rotate-180":s.value}])},null,8,["class"])]),s.value?(w(),g("div",{key:0,class:v(["absolute z-10 mt-1 w-64 max-h-60 overflow-auto bg-white rounded-lg shadow-lg border border-gray-200 transform origin-top transition-all duration-200",s.value?"scale-100 opacity-100":"scale-95 opacity-0"])},[d("div",J,[P(d("input",{type:"text","onUpdate:modelValue":h[1]||(h[1]=y=>u.value=y),placeholder:"Search country...",class:v(["w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",n.inputClass])},null,2),[[_,u.value]])]),d("div",D,[(w(!0),g(j,null,F(f.value,y=>(w(),g("button",{key:y.code,onClick:Y=>c(y),class:"w-full px-4 py-2 text-left hover:bg-gray-100 transition-colors duration-200 flex items-center gap-2"},[k(T,{name:y.flag,class:"w-5 h-5"},null,8,["name"]),d("span",K,b(y.name),1),d("span",M,"+"+b(y.code),1)],8,q))),128))])],2)):C("",!0)]),d("div",R,[d("input",{type:"tel",pattern:"\\d*",inputmode:"numeric",value:l.value,onInput:i,placeholder:n.placeholder,class:v(["w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200 text-gray-900 placeholder:text-gray-400 bg-gray-50",{"border-red-500":n.error}])},null,42,G),n.error?(w(),g("p",z,b(n.error),1)):C("",!0)])])])}}}),H=["onUpdate:modelValue","onInput","onKeydown"],re=S({__name:"index",props:V({otpLength:{},verifyStatus:{}},{modelValue:{type:Array,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const t=E([]),e=I(a,"modelValue"),r=a,s=async o=>(await navigator.clipboard.readText()).replace(/\D/g,"").split("").slice(0,r.otpLength),u=(o,l)=>{var i;o.target.value&&l<r.otpLength-1&&((i=t.value[l+1])==null||i.focus())},p=async(o,l)=>{var c,i;if(o.code.toLowerCase()==="KeyV"&&o.ctrlKey){o.preventDefault();const O=await s();e.value=O}else o.key==="ArrowLeft"&&l>0?(c=t.value[l-1])==null||c.focus():o.key==="ArrowRight"&&l<r.otpLength-1&&((i=t.value[l+1])==null||i.focus())};return(o,l)=>(w(!0),g(j,null,F(o.otpLength||6,(f,c)=>P((w(),g("input",{key:c,type:"text",maxlength:"1",class:v(["w-12 h-12 text-center text-xl font-semibold bg-gray-50 border border-gray-300 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200",{"border-red-500":o.verifyStatus==="failed","border-green-300":o.verifyStatus==="success"&&e.value[c]!=="","border-gray-300":o.verifyStatus==="idle"&&e.value[c]===""}]),"onUpdate:modelValue":i=>e.value[c]=i,onInput:i=>u(i,c),onKeydown:i=>p(i,c),ref_for:!0,ref_key:"otpInputs",ref:t,placeholder:"0"},null,42,H)),[[_,e.value[c]]])),128))}});class oe{constructor(t,e){this.phone=t,this.authOtpStrategy=e}async execute(){const t=await this.authOtpStrategy.sendOtp(this.phone);return console.log("Command: Send OTP By Phone"),console.log("otp :",t),t}}class ae{constructor(t,e,r){this.phone=t,this.otp=e,this.authOtpStrategy=r}async execute(){const t=await this.authOtpStrategy.verifyOtp({resource:this.phone,otp:this.otp});return console.log("Command: Verify OTP By Phone"),console.log("verify :",t),t}}class se{constructor(t,e){this.userId=t,this.authOtpStrategy=e}async execute(){const t=await this.authOtpStrategy.createToken(this.userId);console.log("Command: Create Token OTP By Phone"),console.log("token :",t)}}class ne{constructor(t,e){this.phone=t,this.authOtpStrategy=e}execute(){try{const t=this.authOtpStrategy.getUserByPhoneNumber(this.phone);return console.log("Fetched User",t),t}catch(t){throw new Error(t instanceof Error?t.message:"bad request")}}}class ce{constructor(t,e){this.user=t,this.authOtpStrategy=e}execute(){try{return this.authOtpStrategy.createUser(this.user)}catch(t){throw new Error(t instanceof Error?t.message:"bad request")}}}class ie{constructor(t,e){this.OtpId=t,this.authOtpStrategy=e}execute(){try{return this.authOtpStrategy.removeOtp(this.OtpId)}catch(t){throw new Error(t instanceof Error?t.message:"bad request")}}}class Q{async sendOtp(t){try{const e=await fetch("/api/otp",{method:"POST",body:JSON.stringify({phoneNumber:t}),headers:{"Content-Type":"application/json"}}),r=await e.json();if(!e.ok)throw new Error(r.statusText||"Failed to send OTP.");return{resource:t,otp:r.data}}catch(e){throw new Error(e instanceof Error?e.message:"An unknown error occurred while sending OTP.")}}async verifyOtp(t){try{const e=await fetch(`/api/otp/verify-phone?phoneNumber=${t.resource}&code=${t.otp}`),r=await e.json();if(!e.ok)throw new Error(r.statusText||"Failed to verify OTP.");if(r&&r.data.code===t.otp){const u=await(await fetch("/api/otp",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r.data,is_used:!0})})).json();return!0}else return!1}catch(e){throw new Error(e instanceof Error?e.message:"An unknown error occurred while verifying OTP.")}}async createToken(t){try{const e=await fetch("/api/auth/gen-token",{method:"POST",body:JSON.stringify({id:t}),headers:{"Content-Type":"application/json"}}),r=await e.json();if(!e.ok)throw new Error(r.statusText||"Failed to create token.");return r.data}catch(e){throw new Error(e instanceof Error?e.message:"An unknown error occurred while creating token.")}}async createUser(t){try{const e=await fetch("/api/users",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}),r=await e.json();if(!e.ok)throw new Error(r.statusText||"Failed to create user.");return r.data}catch(e){throw new Error(e instanceof Error?e.message:"An unknown error occurred while signing up.")}}async getUserByEmail(t){try{const e=await fetch(`/api/users/email?email=${t}`),r=await e.json();if(!r)throw new Error(r.statusText||"Failed to get user by email.");if(!e.ok)throw new Error(r.statusText||"Failed to get user.");return r.data}catch(e){throw new Error(e instanceof Error?e.message:"internal server error")}}async getUserByPhoneNumber(t){try{const e=await fetch(`/api/users/phone?phoneNumber=${t}`),r=await e.json();if(!r)throw new Error(r.statusText||"Failed to get user by phone.");if(!e.ok)throw new Error(r.statusText||"Failed to get user.");return r.data}catch(e){throw new Error(e instanceof Error?e.message:"internal server error")}}async removeOtp(t){try{const e=await fetch(`/api/otp/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!e.ok){const s=await e.json();throw new Error(s.statusText||"Failed to remove user.")}return await e.json()}catch(e){throw new Error(e instanceof Error?e.message:"internal server error")}}}class W{async sendOtp(t){try{const e=await fetch("/api/otp",{method:"POST",body:JSON.stringify({email:t}),headers:{"Content-Type":"application/json"}}),r=await e.json();if(!e.ok)throw new Error(r.statusText||"Failed to send OTP.");return{resource:t,otp:r.data}}catch(e){throw new Error(e instanceof Error?e.message:"An unknown error occurred while sending OTP.")}}async verifyOtp(t){try{const e=await fetch(`/api/otp/verify-email?email=${t.resource}`),r=await e.json();if(!e.ok)throw new Error(r.statusText||"Failed to verify OTP.");return!!(r&&r.data.code===t.otp)}catch(e){throw new Error(e instanceof Error?e.message:"An unknown error occurred while verifying OTP.")}}async createToken(t){try{const e=await fetch("/api/auth/gen-token",{method:"POST",body:JSON.stringify({id:t}),headers:{"Content-Type":"application/json"}}),r=await e.json();if(!e.ok)throw new Error(r.statusText||"Failed to create token.");return r.data}catch(e){throw new Error(e instanceof Error?e.message:"An unknown error occurred while creating token.")}}async createUser(t){try{const e=await fetch("/api/users",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}),r=await e.json();if(!e.ok)throw new Error(r.statusText||"Failed to create user.");return r.data}catch(e){throw new Error(e instanceof Error?e.message:"An unknown error occurred while signing up.")}}async getUserByEmail(t){try{const e=await fetch(`/api/users/email?email=${t}`),r=await e.json();if(!r)throw new Error(r.statusText||"Failed to get user by email.");if(!e.ok)throw new Error(r.statusText||"Failed to get user.");return r.data}catch(e){throw new Error(e instanceof Error?e.message:"internal server error")}}async getUserByPhoneNumber(t){try{const e=await fetch(`/api/users/phone?phoneNumber=${t}`),r=await e.json();if(!r)throw new Error(r.statusText||"Failed to get user by email.");if(!e.ok)throw new Error(r.statusText||"Failed to get user.");return r.data}catch(e){throw new Error(e instanceof Error?e.message:"internal server error")}}async removeOtp(t){try{const e=await fetch(`/api/otp/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!e.ok){const s=await e.json();throw new Error(s.statusText||"Failed to remove user.")}return await e.json()}catch(e){throw new Error(e instanceof Error?e.message:"internal server error")}}}class le{static createOTPStrategy(t){switch(t){case"sms":return new Q;case"email":return new W;default:throw new Error("auth type not implemented")}}}const X=window.setInterval;function ue(a){const t=E(a),e=E(!1);let r=null;const s=()=>{e.value||t.value<=0||(e.value=!0,r=X(()=>{t.value>0?(t.value-=1e3,t.value<0&&(t.value=0)):u()},1e3))},u=()=>{r&&clearInterval(r),e.value=!1},p=(i=a)=>{u(),t.value=i},o=m(()=>Math.floor(t.value/1e3)),l=m(()=>Math.floor(o.value/60)),f=m(()=>o.value%60),c=m(()=>`${String(l.value).padStart(2,"0")}:${String(f.value).padStart(2,"0")}`);return x(()=>u()),{millisecondsLeft:t,isRunning:e,formatted:c,start:s,stop:u,reset:p}}export{le as A,se as C,ne as G,ie as R,oe as S,ae as V,re as _,te as a,ce as b,ue as u};
