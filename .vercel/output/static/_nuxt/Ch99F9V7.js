import{u as G,_ as I,A as k,S as D,G as N,a as L,V as M,R as W,C as q}from"./CzrAGLr7.js";import H from"./GQPUnmNe.js";import{_ as J}from"./BHCqIXxc.js";import{d as K,m as Q,p as O,s as X,r as P,c as Y,g as Z,o as ee,a as m,b as l,h as a,q as f,u as o,v as T,x as U,y as te,j as V,t as oe,l as E,k as se,z as i,A as ne}from"./CMCxBn70.js";import{u as ae}from"./M9v_ylco.js";import{a as re}from"./D2lfmPiW.js";import{_ as ie}from"./DlAUqK2U.js";import"./Cb26PGfG.js";import"./C7JPyPC4.js";const le={class:"min-h-screen flex items-center justify-center bg-[#EAEFEF]"},ue={class:"flex flex-col justify-center items-center w-full rounded-md md:w-fit bg-white p-8 md:p-14 shadow-md"},de={class:"w-full max-w-sm"},ce={class:"mb-8 text-center"},me={key:0,class:"text-gray-500"},pe=["disabled"],fe={key:0},ge={key:2,class:"flex flex-col space-y-4 bg-zinc-100 rounded-lg p-3"},ye={class:"grid grid-cols-6 gap-2"},ve={class:"flex items-center justify-between mt-4"},he=["disabled"],xe={key:1,class:"p-2 flex items-center justify-center gap-2 rounded-lg text-gray-700/60 font-semibold capitalize text-sm"},be={class:"text-center mt-4 text-sm text-gray-500"},j=6,we=K({__name:"index",setup(_e){const{formatted:A,start:B,stop:x,isRunning:b}=G(3e5),R=Q(),s=O({otp:Array(6).fill(""),phoneNumber:"",countryCode:"20"}),w=O({otp:!1,phoneNumber:!1}),r=X("inputs"),{userStore:S}=ae(),u=P("idle"),n=P(!1),y=P(),v=[],g=Y(()=>s.phoneNumber.startsWith("0")?`${s.countryCode}${s.phoneNumber.slice(1)}`:`${s.countryCode}${s.phoneNumber}`);async function _(){try{n.value=!0;const t=k.createOTPStrategy("sms"),e=new D(g.value,t);if(!await new N(g.value,t).execute())throw i.error("User not found, please register first"),new Error("User not found, please register first");const h=await e.execute();y.value=h.otp,r.value="otp",n.value=!1,B(),i.success("OTP sent successfully Check your phone")}catch(t){r.value="inputs",n.value=!1,i.error(t instanceof Error?t.message:"handle login error",{duration:5e3})}}async function $(){try{await _()}catch(t){x(),u.value="failed",r.value="inputs",i.error(t instanceof Error?t.message:"handle resend error",{duration:5e3})}}async function z(){try{n.value=!0;const t=k.createOTPStrategy("sms"),d=await new N(g.value,t).execute();if(!d){i.error("Failed to login");return}S.value=d,await new q(d.id,t).execute(),n.value=!1,i.success("Verified successfully ,redirecting to dashboard"),v.push(setTimeout(()=>{R.push("/dashboard")},200))}catch(t){r.value="otp",i.error(t instanceof Error?t.message:"handle create token error",{duration:5e3})}}async function F(){try{let t;n.value=!0,u.value="idle";const e=k.createOTPStrategy("sms"),p=await new N(g.value,e).execute();if(!p)throw new Error("User not found, please register first");S.value=p;const C=await new M(g.value,s.otp.join(""),e).execute();if(!y.value)throw new Error("Can't OTP data, please try again");const c=new W(y.value.id,e);if(!C){u.value="failed",n.value=!1,r.value="otp",i.error("Invalid OTP, please try again");return}await z(),await c.execute(),n.value=!1,u.value="success",x(),i.success("OTP verified successfully",{duration:1e3}),await ne("/dashboard")}catch(t){u.value="failed",n.value=!1,r.value="otp",i.error(t instanceof Error?t.message:"confirm otp error",{duration:5e3})}}return Z(()=>s.otp.join("").length,async t=>{t===j&&F()}),ee(()=>{v==null||v.forEach(t=>{clearTimeout(t)}),x(),y.value=void 0,u.value="idle",n.value=!1,r.value="inputs",s.otp=Array(6).fill(""),s.phoneNumber="",s.countryCode="20",w.otp=!1,w.phoneNumber=!1}),re({title:"login",description:"login to your account"}),(t,e)=>{const d=L,p=H,h=I,C=J;return l(),m("div",le,[a("div",ue,[a("div",de,[a("div",ce,[e[3]||(e[3]=a("h1",{class:"font-logo text-accent text-3xl mb-5"},"Tajammoa",-1)),e[4]||(e[4]=a("h2",{class:"text-xl font-semibold text-gray-800 mb-1"}," Welcome to event management platform ",-1)),o(r)==="inputs"?(l(),m("p",me," Sign in to continue ")):f("",!0)]),a("form",{class:"space-y-6",onSubmit:T(_,["prevent"])},[o(r)==="inputs"?(l(),U(d,{key:0,modelValue:o(s).phoneNumber,"onUpdate:modelValue":e[0]||(e[0]=c=>o(s).phoneNumber=c),countryCode:o(s).countryCode,"onUpdate:countryCode":e[1]||(e[1]=c=>o(s).countryCode=c),placeholder:"Enter your phone number",error:!o(s).phoneNumber&&o(w).phoneNumber?"Please enter your phone number":void 0},null,8,["modelValue","countryCode","error"])):f("",!0),o(r)==="inputs"?(l(),m("button",{key:1,type:"button",class:"w-full flex items-center justify-center gap-2 py-3 rounded-lg bg-gray-800 hover:bg-gray-900 text-white font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow",disabled:o(n)||!o(s).phoneNumber,onClick:T(_,["prevent"])},[o(n)?(l(),U(p,{key:1,name:"line-md:loading-twotone-loop",class:"animate-spin text-xl mx-auto"})):(l(),m("span",fe,"Sign in"))],8,pe)):f("",!0),o(r)==="otp"?(l(),m("div",ge,[e[6]||(e[6]=a("div",{class:"text-center"},[a("h3",{class:"text-lg font-semibold text-gray-800 mb-2"}," Enter the OTP sent to your phone "),a("p",{class:"text-gray-500 text-sm"}," Please enter the 6-digit code sent to you ")],-1)),a("span",ye,[V(h,{modelValue:o(s).otp,"onUpdate:modelValue":e[2]||(e[2]=c=>o(s).otp=c),"otp-length":j,"verify-status":o(u)},null,8,["modelValue","verify-status"])]),a("span",ve,[e[5]||(e[5]=a("button",{type:"button",class:"p-2 flex items-center justify-center gap-2 rounded-lg text-accent capitalize text-sm hover:bg-accent/15 hover:text-accent transition-all duration-200"}," send to email ",-1)),o(b)?f("",!0):(l(),m("button",{key:0,type:"button",class:"p-2 flex items-center justify-center gap-2 rounded-lg text-accent capitalize text-sm hover:bg-accent/15 hover:text-accent transition-all duration-200",disabled:o(b)||o(n),onClick:$}," re-send ",8,he)),o(b)?(l(),m("p",xe," re-send again : "+oe(o(A)),1)):f("",!0)])])):f("",!0),e[9]||(e[9]=te('<div class="flex items-center my-2" data-v-83d954ff><div class="flex-1 h-px bg-gray-200" data-v-83d954ff></div><span class="mx-3 text-gray-400 text-sm" data-v-83d954ff>or</span><div class="flex-1 h-px bg-gray-200" data-v-83d954ff></div></div><button type="button" class="w-full flex items-center justify-center gap-2 py-3 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 text-gray-700 font-medium transition-all duration-200" data-v-83d954ff><img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" class="w-5 h-5" data-v-83d954ff> Sign in with Google </button>',2)),a("div",be,[e[8]||(e[8]=E(" New user? ")),V(C,{to:"/register",class:"text-accent hover:underline"},{default:se(()=>e[7]||(e[7]=[E("Create Account")])),_:1,__:[7]})])],32)])])])}}}),Ee=ie(we,[["__scopeId","data-v-83d954ff"]]);export{Ee as default};
