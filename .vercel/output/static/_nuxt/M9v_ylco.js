import{c2 as x,bG as D,K as N,c3 as I,r as b,a4 as S,g as j,a3 as R,aJ as P,ab as _,c as L}from"./CMCxBn70.js";import{i as M,u as U}from"./Cb26PGfG.js";const $="$s";function V(...e){const i=typeof e[e.length-1]=="string"?e.pop():void 0;typeof e[0]!="string"&&e.unshift(i);const[t,o]=e;if(!t||typeof t!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+t);if(o!==void 0&&typeof o!="function")throw new Error("[nuxt] [useState] init must be a function: "+o);const n=$+t,r=x(),a=D(r.payload.state,n);if(a.value===void 0&&o){const s=o();if(N(s))return r.payload.state[n]=s,s;a.value=s}return a}function F(e,i){if(typeof e!="string")throw new TypeError("argument str must be a string");const t={},o=i||{},n=o.decode||K;let r=0;for(;r<e.length;){const a=e.indexOf("=",r);if(a===-1)break;let s=e.indexOf(";",r);if(s===-1)s=e.length;else if(s<a){r=e.lastIndexOf(";",a-1)+1;continue}const u=e.slice(r,a).trim();if(o!=null&&o.filter&&!(o!=null&&o.filter(u))){r=s+1;continue}if(t[u]===void 0){let f=e.slice(a+1,s).trim();f.codePointAt(0)===34&&(f=f.slice(1,-1)),t[u]=z(f,n)}r=s+1}return t}function K(e){return e.includes("%")?decodeURIComponent(e):e}function z(e,i){try{return i(e)}catch{return e}}const w=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function C(e,i,t){const o=t||{},n=o.encode||encodeURIComponent;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!w.test(e))throw new TypeError("argument name is invalid");const r=n(i);if(r&&!w.test(r))throw new TypeError("argument val is invalid");let a=e+"="+r;if(o.maxAge!==void 0&&o.maxAge!==null){const s=o.maxAge-0;if(Number.isNaN(s)||!Number.isFinite(s))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(s)}if(o.domain){if(!w.test(o.domain))throw new TypeError("option domain is invalid");a+="; Domain="+o.domain}if(o.path){if(!w.test(o.path))throw new TypeError("option path is invalid");a+="; Path="+o.path}if(o.expires){if(!B(o.expires)||Number.isNaN(o.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&(a+="; HttpOnly"),o.secure&&(a+="; Secure"),o.priority)switch(typeof o.priority=="string"?o.priority.toLowerCase():o.priority){case"low":{a+="; Priority=Low";break}case"medium":{a+="; Priority=Medium";break}case"high":{a+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(o.sameSite)switch(typeof o.sameSite=="string"?o.sameSite.toLowerCase():o.sameSite){case!0:{a+="; SameSite=Strict";break}case"lax":{a+="; SameSite=Lax";break}case"strict":{a+="; SameSite=Strict";break}case"none":{a+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return o.partitioned&&(a+="; Partitioned"),a}function B(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function l(e){if(typeof e!="object")return e;var i,t,o=Object.prototype.toString.call(e);if(o==="[object Object]"){if(e.constructor!==Object&&typeof e.constructor=="function"){t=new e.constructor;for(i in e)e.hasOwnProperty(i)&&t[i]!==e[i]&&(t[i]=l(e[i]))}else{t={};for(i in e)i==="__proto__"?Object.defineProperty(t,i,{value:l(e[i]),configurable:!0,enumerable:!0,writable:!0}):t[i]=l(e[i])}return t}if(o==="[object Array]"){for(i=e.length,t=Array(i);i--;)t[i]=l(e[i]);return t}return o==="[object Set]"?(t=new Set,e.forEach(function(n){t.add(l(n))}),t):o==="[object Map]"?(t=new Map,e.forEach(function(n,r){t.set(l(r),l(n))}),t):o==="[object Date]"?new Date(+e):o==="[object RegExp]"?(t=new RegExp(e.source,e.flags),t.lastIndex=e.lastIndex,t):o==="[object DataView]"?new e.constructor(l(e.buffer)):o==="[object ArrayBuffer]"?e.slice(0):o.slice(-6)==="Array]"?new e.constructor(e):e}const H={path:"/",watch:!0,decode:e=>I(decodeURIComponent(e)),encode:e=>encodeURIComponent(typeof e=="string"?e:JSON.stringify(e))},g=window.cookieStore;function q(e,i){var f;const t={...H,...i};t.filter??(t.filter=c=>c===e);const o=T(t)||{};let n;t.maxAge!==void 0?n=t.maxAge*1e3:t.expires&&(n=t.expires.getTime()-Date.now());const r=n!==void 0&&n<=0,a=r||o[e]===void 0||o[e]===null,s=l(r?void 0:o[e]??((f=t.default)==null?void 0:f.call(t))),u=n&&!r?G(s,n,t.watch&&t.watch!=="shallow"):b(s);{let c=null;try{!g&&typeof BroadcastChannel<"u"&&(c=new BroadcastChannel(`nuxt:cookies:${e}`))}catch{}const p=(d=!1)=>{!d&&(t.readonly||M(u.value,o[e]))||(Y(e,u.value,t),o[e]=l(u.value),c==null||c.postMessage({value:t.encode(u.value)}))},v=d=>{var y;const m=d.refresh?(y=T(t))==null?void 0:y[e]:t.decode(d.value);h=!0,u.value=m,o[e]=l(m),_(()=>{h=!1})};let h=!1;const E=!!R();if(E&&S(()=>{h=!0,p(),c==null||c.close()}),g){const d=m=>{const y=m.changed.find(k=>k.name===e),O=m.deleted.find(k=>k.name===e);y&&v({value:y.value}),O&&v({value:null})};g.addEventListener("change",d),E&&S(()=>g.removeEventListener("change",d))}else c&&(c.onmessage=({data:d})=>v(d));t.watch&&j(u,()=>{h||p()},{deep:t.watch!=="shallow"}),a&&p(a)}return u}function T(e={}){return F(document.cookie,e)}function J(e,i,t={}){return i==null?C(e,i,{...t,maxAge:-1}):C(e,i,t)}function Y(e,i,t={}){document.cookie=J(e,i,t)}const A=2147483647;function G(e,i,t){let o,n,r=0;const a=t?b(e):{value:e};return R()&&S(()=>{n==null||n(),clearTimeout(o)}),P((s,u)=>{t&&(n=j(a,u));function f(){r=0,clearTimeout(o);const c=i-r,p=c<A?c:A;o=setTimeout(()=>{if(r+=p,r<i)return f();a.value=void 0,u()},p)}return{get(){return s(),a.value},set(c){f(),a.value=c,u()}}})}const Q={user:"user",eventDetails:"eventDetails"},W=()=>{const e=V(Q.user,()=>b(null)),i=L(()=>{var n,r;return`${(n=e.value)==null?void 0:n.first_name} ${(r=e.value)==null?void 0:r.last_name}`});q("token");const t=async()=>{try{const n=await $fetch("/api/auth/logout",{method:"POST",onResponse:({response:r})=>{r.ok?e.value=null:console.log("failed to logout")}});return console.log("user logout res",n),n}catch(n){console.error(n)}},{status:o}=U("/api/users/me",{key:"user-me",onResponse:({response:n})=>{var r;n.ok?e.value=(r=n==null?void 0:n._data)==null?void 0:r.data:console.error("failed to get user")},immediate:e.value===null,lazy:e.value!==null},"$78hYVQ0S5N");return{logout:t,userStore:e,fullName:i}};export{V as a,Q as s,W as u};
